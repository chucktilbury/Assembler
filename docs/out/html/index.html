<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Goldfish: Goldfish</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Goldfish
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Goldfish </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__home_chuck_Src_goldfish_README"></a> Goldfish is a C-like, multi-pass, compiled programming language that runs on its own virtual machine. The structure of the suite is very old-school in that the compiler compiles to assembler, then the assembler writes a binary which the VM uses. These stages of compilation are all totally separate and independent. This makes the code more simple and also aids in debugging, but does not diminish runtime performance. It also allows the distribution of portable binary executable files instead to distributing the source code as required by some interpreted languages.</p>
<p>The design goals of the Goldfish language are simplicity and efficiency. The language is very simple to learn and read but also robust and complete. Every effort is made to make coding shortcuts superfluous and to have exactly one way to accomplish some specific task. The design of the compiler and other infrastructure is to be very extensible. Extensions can be easily written and compiled in using C. The internal data structures of the assembler are very simple and easy to understand and a minimum of code needs to be written in Goldfish to interface an extension. Internally extensions are implemented by the notion of a trap, which is a very clean and efficient way to pass state to the external library and receive state back upon completion of the call. The goal of that is to have as little code as possible run in the VM and as much as possible run natively.</p>
<p>Goldfish source code is structured to be processed using a dedicated C preprocessor. The preprocessor can handle macros and includes as expected. Instead of linking goldfish modules together, the preprocessor <code>#include</code>statement is to bring in other modules. Naming issues are resolved using namespaces.</p>
<h3><a class="anchor" id="autotoc_md15"></a>
Comments</h3>
<p>Comments are the save as C. Both C and C++ comments are acceptable. All comments are stripped out by the preprocessor.</p>
<div class="fragment"><div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment">    This is a comment</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// So is this</span></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md16"></a>
Namespaces</h3>
<p>A namespace can appear anywhere in code that is outside of any other definition except a namespace. When name spaces are nested, then the namespace name must be used to access symbols that are used within the nested namespace. They define a naming prefix that is intended solely for the purpose of resolving name conflicts. When a name is defined within a namespace, the namespace name does not need to be specified and if a name is duplicated within a namespace then that is a syntax error. When something appears outside of any namespace, then the default namespace is used, which is <code>root</code>. A namespace does not name a type and you cannot refer to it as a variable.</p>
<div class="fragment"><div class="line">number something = 0</div>
<div class="line"><span class="keyword">namespace </span>some_name {</div>
<div class="line">    number something = 123</div>
<div class="line">    <span class="comment">// stuff goes here</span></div>
<div class="line">    <span class="comment">// The name &quot;something&quot; refers to some_name.something, whereas the </span></div>
<div class="line">    <span class="comment">// name &quot;root.something&quot; referrs to the one defined outside of the name space.</span></div>
<div class="line">    <span class="keyword">namespace </span>another {</div>
<div class="line">        number something = 234</div>
<div class="line">        <span class="comment">// something refers to &quot;root.some_name.another.something&quot;</span></div>
<div class="line">        <span class="comment">// and so on</span></div>
<div class="line">    }</div>
<div class="line">    <span class="comment">// the name something here refers to root.some_name.something.</span></div>
<div class="line">} <span class="comment">// semicolons are treated as whitespace</span></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md17"></a>
Structs</h3>
<p>A struct names a simple type that does not have a constructor or destructor. It can appear anywhere in a module, including inside another struct. The syntax of using a struct is a same as any other type and creating an instance of a struct defines the contents of it as cleared unless an initilizer is provided. A struct can have function pointers but not function definitions.</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>something {} <span class="comment">// empty struct</span></div>
<div class="line"><span class="keyword">namespace </span>some_name {</div>
<div class="line">    something another <span class="comment">// same as &quot;root.something another&quot; and defines an instance</span></div>
<div class="line">    <span class="keyword">struct </span>something {  <span class="comment">// defines a local type of struct &quot;something&quot;. This changes the</span></div>
<div class="line">                        <span class="comment">// meaning of the previous line </span></div>
<div class="line">        <span class="keyword">struct </span>another {</div>
<div class="line">            <span class="comment">// define a nested struct</span></div>
<div class="line">        }</div>
<div class="line">}</div>
<div class="line">some_name.something var <span class="comment">// this refers to the on in the name space.</span></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md18"></a>
Classes</h3>
<p>A class is a more complicated struct that has constructors and destructors. It names a type that, when an object of that type is created or destroyed, a specific function is called. Single inheritance is supported. Monkey patching is specifically not supported. The object model for Goldfish is similar to Python where to override a method or attribute, you simply define it for the child class. To access the parent version of a method or attribute, simply use the class name. Classes may be nested, but the preferred idea is to use a struct and initialize it explicitly.</p>
<div class="fragment"><div class="line"><span class="comment">// define a class in the root namespace</span></div>
<div class="line"><span class="keyword">class </span>outside {</div>
<div class="line">    <span class="comment">// state and methods as usual</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>a_name {</div>
<div class="line">    <span class="comment">// define a class inside a namespace</span></div>
<div class="line">    <span class="keyword">class </span>inside(outside) {</div>
<div class="line">        <span class="comment">// the contents of outside are accesible as if they are local and defining</span></div>
<div class="line">        <span class="comment">// a duplicate name overrides the definition in outside.</span></div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md19"></a>
Methods</h3>
<p>A method is a construct that holds executable code. It can appear anywhere in the source and adheres to the naming conventions described above. See examples for contents of a method. Methods return a value of a particular type (or nothing) and the parameters of a method are strongly typed. Method names, including those defined outside of a class are decorated with the parameter types to support overriding the method name.</p>
<div class="fragment"><div class="line">...</div>
<div class="line"><span class="comment">// general syntax</span></div>
<div class="line">return_type_name method_name(method parameters) { method contents }</div>
<div class="line">...</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md20"></a>
Assembler</h1>
<p>This is a register based virtual machine and the assembler for the Goldfish language. The idea is to create an assembler and virtual machine, along with support programs that will allow clear definition of any construct. It should be as simple as possible and still allow for robust programming. For efficiency and speed, only the most basic functions are implemented in assembly. As much functionality as possible is moved out to native code. So the actual assembly language is limited to flow control, arithmetic, and the native code interface. The Goldfish compiler will compile to assembly for this assembler and VM.</p>
<p>The assembler makes several passes on the source code in order to allow for things like referencing labels before they are defined.</p><ul>
<li>Multiple passes over the AST allows for optimizations.</li>
<li>Garbage collection is implemented using the Boehm GC library. (<a href="https://en.wikipedia.org/wiki/Boehm_garbage_collector">https://en.wikipedia.org/wiki/Boehm_garbage_collector</a>)</li>
<li>Robust string formatting and substitutions are supported.</li>
<li>Running arbitrary C code is supported through a system of traps.</li>
<li>The output of the assembler is completely serialized.</li>
<li>A C preprocessor is provided with this source code, but any one will work.</li>
</ul>
<p>The only external requirement is the garbage collector.</p>
<p>Linux is the only supported operating system for now. The system has not been compiled under Windows or MacOS. There are no plans to support them, since I don't have those systems.</p>
<h1><a class="anchor" id="autotoc_md21"></a>
Build</h1>
<ul>
<li>Clone the repository</li>
<li>Edit the .project_env file so that your source code directory is represented in the _PROJECT_LOC environment variable.</li>
<li>Run the setup script: <code>./setup &lt;build type&gt;</code> where build type is debug, release, or profile.</li>
<li>Run make from the build directory.</li>
</ul>
<h1><a class="anchor" id="autotoc_md22"></a>
Run</h1>
<p>There are several programs.</p><ul>
<li>cpp - A dedicated C language pre-processor. This step is required for the test programs. We use it mostly to create macros and hide the comments.</li>
<li>gasm - The assembler that takes pre-processed text and outputs a binary file for the virtual machine. This is a work in progress. It should be impossible to create incorrect output but there are generation errors that the assembler does not catch. That having been said, correct input produces correct output. (as far as I can tell)</li>
<li>disasm - Decompile a binary that was output by the assembler.</li>
<li>vmachine - The virtual machine. This runs the binary that was created.</li>
<li>asm - This is a simple shell that builds and runs the program.</li>
</ul>
<p>Using these utilities is intended to be easy, but there are many options. The "-v" option is for verbosity and allows quite a bit of introspection of these applications. Note that if you actually have used the setup script, these utilities will be in your path.</p>
<h2><a class="anchor" id="autotoc_md23"></a>
Build and run the fibonacci benchmark the hard way.</h2>
<ul>
<li><code>cd ../tests</code></li>
<li><code>../bin/cpp -o fibonacci.i fibonacci.s -I../src/runtime</code></li>
<li><code>../bin/gasm -o fibonacci.bin fibonacci.i</code></li>
<li><code>../bin/vmachine fibonacci.bin</code></li>
</ul>
<h2><a class="anchor" id="autotoc_md24"></a>
Build and run the easy way</h2>
<p>(assuming you have used the setup utility)</p><ul>
<li><code>asm -r fibonacci.s</code></li>
</ul>
<h2><a class="anchor" id="autotoc_md25"></a>
Build and run, with seeing a lot of state information from the assembler.</h2>
<ul>
<li><code>asm -r -v20 fibonacci.s</code></li>
</ul>
<p>There are many other build and run options. Look in the source code and in the CMakeLists.txt files. All of the utilities also support a help command parameter as <code>-h</code>.</p>
<p>For the current plan and other information, including random thoughts and probably wrong thinking, then take a look at the notes.md file in this directory. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Sun Dec 4 2022 22:08:27 for Goldfish by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
